# address_normalizer
日本住所の分割、正規化を行うライブラリ

## 住所分割仕様
住所を都道府県、市区町村、町域、丁目-番地-号、それ以外（ビル名、号室名）に分割します.  
TODO: 正規表現で分割するか、郵便番号のデータを使用してマッチング、分割するかどちらが性能が出るか確認しつつ実装します.  
郵便番号のデータとマッチングする場合はレコード毎に大量のループが発生するため、正規表現での分割でまず実装.

### 都道府県の分割
+ 正規表現  
どちらか.
  + ([^\\x00-\\x7F]{2,3}県|..府|東京都|北海道)
  + (東京都|北海道|(?:京都|大阪)府|.{2,3}県)
  + (東京都|北海道|(?:京都|大阪)府|(?:神奈川|和歌山|鹿児島|.{2})県)

### 市区町村の分割
+ 正規表現  
ネットでは以下正規表現を見かけるが、どちらもうまく動いている感じがしない.
  + (...??[都道府県])((?:旭川|伊達|石狩|盛岡|奥州|田村|南相馬|那須塩原|東村山|武蔵村山|羽村|十日町|上越|富山|野々市|大町|蒲郡|四日市|姫路|大和郡山|廿日市|下松|岩国|田川|大村)市|.+?郡(?:玉村|大町|.+?)[町村]|.+?市.+?区|.+?[市区町村])  
  https://qiita.com/zakuroishikuro/items/066421bce820e3c73ce9  
  

  (東京都|北海道|(?:京都|大阪)府|(?:神奈川|和歌山|鹿児島|.{2})県)((?:旭川|伊達|石狩|盛岡|奥州|田村|南相馬|那須塩原|東村山|武蔵村山|羽村|十日町|上越|富山|野々市|大町|蒲郡|四日市|姫路|大和郡山|廿日市|下松|岩国|田川|大村)市|.+?郡(?:玉村|大町|.+?)[町村]|.+?市.+?区|.+?[市区町村])
  

  + (余市郡(仁木町|赤井川村|余市町)|余市町|柴田郡村田町|(武蔵|東)村山市|[東西北]村山郡...?町|田村(市|郡..町)芳賀郡市貝町|(佐波郡)?玉村町|[羽大]村市|(十日|大)町市|(中新川郡)?上市町|(野々|[四廿]日)市市|西八代郡市川三郷町|神崎郡市川町|高市郡(高取町|明日香村)|(吉野郡)?下市町|(杵島郡)?大町町)  
  https://qiita.com/jkr_2255/items/c7958b1e62696a1fe183

  + (東京都|北海道|(?:京都|大阪)府|(?:神奈川|和歌山|鹿児島|.{2})県)?((?:高市|静岡市|野々市|西村|西八代郡市|芳賀郡市|羽村|福岡市|神戸市|神崎郡市|相模原市|田村|熊本市|浜松市|武蔵村|横浜市|柴田郡村|杵島郡大町|東村|札幌市|新潟市|廿日市|広島市|川崎市|岡山市|大阪市|大町|大村|堺市|四日市|名古屋市中村|名古屋市|吉野郡下市|千葉市|十日町|北村|北九州市|余市郡余市|余市|佐波郡玉村|仙台市|京都市|中新川郡上市|さいたま市|.)?.*?[市区町村])


(...??[都道府県])((?:高市|静岡市|野々市|西村|西八代郡市|芳賀郡市|羽村|福岡市|神戸市|神崎郡市|相模原市|田村|熊本市|浜松市|武蔵村|横浜市|柴田郡村|杵島郡大町|東村|札幌市|新潟市|廿日市|広島市|川崎市|岡山市|大阪市|大町|大村|堺市|四日市|名古屋市中村|名古屋市|吉野郡下市|千葉市|十日町|北村|北九州市|余市郡余市|余市|佐波郡玉村|仙台市|京都市|中新川郡上市|さいたま市|.)?.*?[市区町村])


### 町域(字等)、丁目-番地-号、それ以外の分割
+ 正規表現  
(([０-９]+)(丁|丁目|東|西|南|北|－)+)?(([０-９]+)(番|番地|番地の|－))?(([０-９]+)(番|番地|号))

   + '丁'て無いじゃない？  
([一二三四五六七八九十百千万０-９]+)([一二三四五六七八九十百千万０-９]+|(丁目|番地|番|号|－|の|東|西|南|北){1,2})*([一二三四五六七八九十百千万０-９]+|(丁目|番地|番|号){1,2})

   + 大阪堺市に'丁'があったため、'丁'を考慮  
([一二三四五六七八九十百千万０-９]+)([一二三四五六七八九十百千万０-９]+|(丁|丁目|番地|番|号|－|の|東|西|南|北){1,2})*([一二三四五六七八九十百千万０-９]+|(丁|丁目|番地|番|号){1,2})

   + 北海道旭川市四条通２３丁目右１号という丁目右、左が判別できない.  
第?([一二三四五六七八九十百千万０-９]+)([一二三四五六七八九十百千万０-９]+|(丁|丁目|番地|番|号|－|の|東|西|南|北|右|左){1,3})*([一二三四五六七八九十百千万０-９]+|(:?丁|丁目|番地|番|号){1,3})

   + ○番耕地,○地割という特殊な住所がある.  
   番耕地, 地割ともに丁目扱いで問題なし(番耕地, 地割ともに丁目と重複することはなく、また丁目と意味が被るため。また町域、町名とはあきらかに別もののため、丁目と同様の扱いで問題ないという判断).  
第?([一二三四五六七八九十百千万０-９]+)([一二三四五六七八九十百千万０-９]+|(番耕地|地割|丁|丁目|番地|番|号|－|の|東|西|南|北|右|左){1,3})*([一二三四五六七八九十百千万０-９]+|(丁|丁目|番地|番|号){1,3})  
第?([一二三四五六七八九十百千万０-９]+)([一二三四五六七八九十百千万０-９]+|(?:番耕地|地割|丁|丁目|番地|番|号|－|の|東|西|南|北|右|左){1,3})*([一二三四五六七八九十百千万０-９]+|(?:丁目|番地|番|号){1,3})

   + 北海道に○線という特殊な住所がある.  
   ○線は町名に該当(丁目, 番地ではない)するため、特別な処理は不要.  
   と思ったけど、

   + 大阪府大阪市中央区久太郎町４丁目に1番・2番・3番と「渡辺」という地番がある.  
   数が少なく、ひとまず無視してよさそう.

   + 大阪府大阪市中央区上町に「A」「B」「C」という丁目がある.
第?([一二三四五六七八九十百千万０-９ABC]+)([一二三四五六七八九十百千万０-９ABC]+|(?:番耕地|地割|丁|丁目|番地|番|号|－|の|東|西|南|北|右|左){1,3})*([一二三四五六七八九十百千万０-９]+|(?:丁目|番地|番|号){1,3})  
第?([一二三四五六七八九十百千万０-９ＡＢＣ]+)([一二三四五六七八九十百千万０-９ＡＢＣ]+|(?:番耕地|地割|丁|丁目|番地|番|号|－|の|東|西|南|北|右|左){1,3})*([一二三四五六七八九十百千万０-９ＡＢＣ]+|(?:丁目|番地|番|号){1,3})  
※何とか大阪府大阪市中央区のときだけ使用する正規表現にならないものか？

   + 千葉県の「イ」「ロ」「ハ」  
   町域と扱えばよい.

   + 石川県の「街区」  
第?([一二三四五六七八九十百千万０-９ＡＢＣ]+)([一二三四五六七八九十百千万０-９ＡＢＣ]+|(?:番耕地|地割|街区|丁|丁目|番地|番|号|－|の|東|西|南|北|右|左){1,3})*([一二三四五六七八九十百千万０-９ＡＢＣ]+|(?:丁目|番地|番|号){1,3}) 

   + 石川県の「ア イ ウ」「甲 乙 丙」「子 丑 寅」「仁 義 礼 智 信」「壱 弐」「1字 2字」  
   第?([一二三四五六七八九十百千万０-９ＡＢＣ]+)([一二三四五六七八九十百千万０-９ＡＢＣイロハニホヘトチリヌルオワカヨタレソあいうえおかきくけこさしすせそ甲乙丙子丑寅卯辰巳午未申酉戌亥]+|(?:番耕地|地割|街区|字|部|、|丁|丁目|番地|番|号|－|の|東|西|南|北|右|左){1,3})*([一二三四五六七八九十百千万０-９ＡＢＣ]+|(?:丁目|番地|番|号){1,3}) 

この表示には２通りある.
+ 住居表示が行われていない地域  
土地の地番をそのまま使います.
「□□町（１丁目）８５５番地１」
「１」は８５５番地を分筆したときの支号（通称、枝番）.
「の」は使わない傾向.

+ 住居表示（住所を分かりやすくする制度）が行われている地域  
「□□町１丁目１番８号」
「□□町１丁目」が「町名」で、１丁目分しかない場合は「□□町」のみになります.「１番」は街区符号で、およそ道路で囲まれたエリア.「８号」は街区の中を一定のルールで順に振った「住居番号」.
一般的には、丁目や番が３桁もあるというのは考えにくい.(3桁あるのは地番)

   + 宮ノ陣町八丁島, 八丁畷町, 郡築一～十一番町, 千丁町太牟田, 千丁町古閑出, 千丁町新牟田, 千丁町吉王丸, 鹿北町四丁, 八丁平, 一番町, 青山奥二～四番川, 北海道上川郡東神楽町１号～２７号


以下まとめ
+ 北海道の場合
(([一二三四五六七八九十百千万０-９]+)[線条通]{1,2}[東西南北]?)  
でマッチングし、マッチした場合、マッチした部分までが町域.それ以外は丁目-番地-号の分割正規表現で分割.

+ 岩手県 盛岡市,花巻市,久慈市,遠野市,釜石市,北上市,八幡平市,宮古市,紫波郡(矢巾町),上閉伊郡(大槌町),下閉伊郡(山田町,普代村),岩手郡(葛巻町,岩手町,雫石町),九戸郡(九戸村,野田村,洋野町,軽米町),和賀郡(西和賀町), の場合  

+ イレギュラーパターン  
  + 北海道,室蘭市,八丁平
  + 岩手県,花巻市,東十二丁目
  + 岩手県,久慈市,二十八日町
  + 宮城県,仙台市若林区,六丁の目
  + 福島県,郡山市,日和田町八丁目
  + 福島県,白河市,七番町５３番地
  + 茨城県,守谷市,百合ケ丘１丁目字並木２３７０番４
  + 栃木県,宇都宮市,三番町３番３６号
  + 



## 住所正規化仕様
### 記入漏れのパターン
  + 都道府県の記入が無い場合  
  都道府県の記入が無い場合は市区町村名から都道府県を類推し、補完する.
    + 同名市区町村は以下が考えられるが、さらに町域名から類推する.ただし、町域名が府中町、本町のケースはどちらの市区町村にも存在するため、完全な類推は不可能.その場合はそれぞれ、東京都府中市、北海道伊達市として補完する.
      + 府中市(東京都、広島県)
      + 伊達市(北海道、福島県)
  + 市区町村の記入が無い場合  
  市区町村の記入が無い場合はデータを補完しない.
  + 町域の記入が無い場合  
  沼田市大字沼田３３８３番地が沼田市３３８３番地のように'大字沼田'が略されていケースがある.この場合はデータを補完しない.

### 表記ゆれパターン
  + 丁目、番地、号のゆれ
    + 「1-1-1」、「1丁目1番地1号」、「一丁目一番地の一号」などは半角数字と'-'(半角ハイフン)「1-1-1」に正規化し同一データと扱う.
  + 町域の字（あざ）の有無
    + 「A市 B区 C町 大字D123」「A市 B区 C町 字D 小字C123」など **'大字','字','小字'は削除**する.
  + 市区町村、町域の送り仮名
    + '之'・'ノ'
      + '之'は市区町村で3箇所、町域では大量に使用されている.
      + 'ノ'も市区町村で3箇所、町域では大量に使用されている.
      + **町域の'之','ノ'は'の'に正規化する**. 市区町村は正規化なしでOK.
    + 'か'・'が'・'ヵ'・'ガ'・'ヶ'・'ケ'  
      + 'か'や'が'は送り仮名、送り仮名以外で使用している市区町村、町域が多数あるため、一律変換はできない.
      + 'ヶ'・'ケ'は市区町村、町域ともに送り仮名にしか使用されていない.(ひとつ町域に'中央マーケット'という町域が存在した.)  
      以上より、**'ヶ'は'ケ'に正規化**する.（マーケットという町域はマーケツトに変換されるが些末なこと.）

      + 'ヵ'は市区町村、町域ともに使用されているケースはない.
      + 'ガ'は市区町村名では使用されているケースが無いが、町域名では送り仮名と'ガーデン'のような送り仮名以外でも使用されている.  
      以上より、**'ヵ'は'ガ'に正規化**する.
    + 'ツ'・'ッ'
      + 'ツ'、'ッ'ともに市区町村では使用なし.町域では送り仮名、送り仮名以外でも大量に使用されている.  
      以上より、'ツ'、'ッ'は特に正規化しない.
  + 異体字
    + '竈'・'釜'・'竃'
    + '恵'・'惠'
    + '斉'・'斎'・'齋'
    + '竜'・'龍'
    + '園'・'苑'  
    など多数あり.ただし、市区町村、町域名に使用されている異字体はそれほど多くなく、

  + 漢数字、算用数字
    + 「A市 13条 一丁目一番地」、「A市 十三条 1丁目-1」など  
    **漢数字は半角数字と'-'(半角ハイフン)に正規化**.

  + 踊り字  
  愛知県東海市名和町トゝメキ１６番地の１など.  
  正規化不要.町域として切り出せれば問題ない.

+ 複雑な町域パターン
  + 京都市内の「通り名」
    + **'上ル'は'上る'に正規化.**
    + **'下ル'は'下る'に正規化.**
    + **'通リ'は'通り'は'通'に正規化.**
    + **'入る'、'入ル'は'入'に正規化.**
  + 北海道の「条」
  + 大阪府堺市の「丁」
  + 長崎県で「郷」「名」「免」「触」「浦」など  
  **以上正規化は実施しない.** 町域として切り出せれば問題ない.

  + 東北北部で用いられる「第○地割」  
  ~~このパターンがある場合は該当文字列を切り出し小字として町域に入れる必要がある.~~
  第○地割=丁目と扱ってよい.  

  + 愛媛県で用いられる「○番耕地」  
  ~~このパターンがある場合は該当文字列を切り出し小字として町域に入れる必要がある.~~
  ○番耕地=丁目と扱ってよい.  

  + 丁目という町域・大字・字があるパターン
    + 宮城県仙台市 仙台市若林区 六丁の目
    + 福島県喜多方市 一丁目～三丁目
    + 埼玉県春日部市 八丁目
    + 埼玉県八潮市 二丁目
    + 静岡県下田市 一丁目～六丁目  
    以上のデータは町域ではなく丁目と誤り分割されてしまう可能性があるため**対策が必要**.

  + 福島県白河市XX番町, 栃木県宇都宮市XX番町, 八丁平等の番、町、丁を町域に含むパターン 
  正規化の必要はないが、住所データからマッチングをする必要がある.


### ビル名、階数、部屋番号があるパターン  
特に正規化を行わない.

## 前提環境
  + lombok1.8+
  + SpringFramework 
  + Commons-lang1.8+

## ビルド

## テスト

## 実行


